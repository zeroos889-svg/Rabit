import{r as n,j as e}from"./ui-vendor-C96WIwkg.js";import{h as pe,m as he,a as je,t as S,C as g,f as Ne,B as p,U as Z,o as fe,I as A,F as ge,b as j}from"./index-Bkz6h1fQ.js";import{L as N}from"./label-CmhXhWbA.js";import{T as G}from"./textarea-CDZ7LSXO.js";import{S as K,a as W,b as X,c as Y,d as _}from"./select-B0y6YODy.js";import{S as ee}from"./skeleton-CH6Aula-.js";import{B as be}from"./badge-DdDRUR73.js";import{C as f}from"./circle-check-DlUG-57U.js";import{B as ve}from"./briefcase-B7DqEMtf.js";import{A as L}from"./arrow-right-yQLf5R-N.js";import{A as B}from"./arrow-left-DgufH9cq.js";import{U as ye}from"./upload-B2zF0UdV.js";import{C as we}from"./circle-alert-BSV6M1IC.js";import"./react-vendor-DDxydHEc.js";import"./query-vendor-Dpt6u7bR.js";import"./chart-vendor-8DIN3ZwM.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=pe("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function Je(){const{isAuthenticated:se}=he(),[,H]=je(),[i,h]=n.useState(1),[x,P]=n.useState(null),[u,C]=n.useState(null),[F,ae]=n.useState(""),[d,O]=n.useState(""),[m,R]=n.useState(""),[k,te]=n.useState(""),[b,I]=n.useState({}),[U,le]=n.useState([]),[t,D]=n.useState(null),{data:E,isLoading:re}=S.consultant.getConsultationTypes.useQuery(),{data:J,isLoading:ne}=S.consultant.getApprovedConsultants.useQuery(void 0,{enabled:i>=2}),ce=S.consultant.uploadFile.useMutation(),q=S.consultant.createBooking.useMutation(),l=E?.types?.find(s=>s.id===x),ie=J?.consultants?.find(s=>s.id===u),de=t?.price??l?.basePriceSAR??l?.price??0,v=t?.slaHours??l?.slaHours??24,$=t?.name||l?.nameAr||"استشارة الموارد البشرية",M=$+" - "+(F||l?.nameAr||"استشارة الموارد البشرية"),z=n.useMemo(()=>{if(!d||!m||!v)return null;const[s,r]=m.split(":").map(Number);if(Number.isNaN(s)||Number.isNaN(r))return null;const a=new Date(d);return a.setHours(s,r,0,0),a.setHours(a.getHours()+v),a.toLocaleString("ar-SA",{dateStyle:"medium",timeStyle:"short"})},[d,m,v]);n.useEffect(()=>{const s=new URLSearchParams(window.location.search),r=s.get("consultantId"),a=s.get("typeId")||localStorage.getItem("rabit-preferred-type"),c=localStorage.getItem("rabit-consulting-package"),y=localStorage.getItem("rabit-last-consultant"),w=localStorage.getItem("rabit-last-slot");if(r&&(C(Number(r)),h(2)),y&&!r){const o=Number(y);Number.isNaN(o)||C(o)}if(a){const o=Number(a);Number.isNaN(o)||P(o)}if(w)try{const o=JSON.parse(w);O(o.date||""),R(o.time||"")}catch{}if(c)try{D(JSON.parse(c))}catch{D(null)}},[]);const V=Array.isArray(l?.requiredDocuments)?l?.requiredDocuments:l?.requiredDocuments?JSON.parse(l.requiredDocuments):[],Q=Array.isArray(l?.requiredInfo)?l?.requiredInfo:l?.requiredInfo?JSON.parse(l.requiredInfo):[],me=async(s,r)=>{const a=s.target.files?.[0];if(a){if(a.size>10*1024*1024){j.error("حجم الملف يجب أن يكون أقل من 10 ميجابايت");return}try{const c=new FileReader;c.onloadend=async()=>{const y=c.result,w=await ce.mutateAsync({fileName:a.name,fileData:y,mimeType:a.type});le(o=>[...o,{name:r,url:w.url,type:a.type}]),j.success(`تم رفع ${r} بنجاح`)},c.readAsDataURL(a)}catch{j.error("فشل رفع الملف")}}},oe=async()=>{if(!se){j.error("يجب تسجيل الدخول أولاً"),H("/login");return}if(!x||!u||!d||!m){j.error("يرجى إكمال جميع الحقول المطلوبة");return}try{const s={...b,...t?{selectedPackage:t}:{}},r=await q.mutateAsync({consultationTypeId:x,consultantId:u,scheduledDate:d,scheduledTime:m,description:k,subject:M,requiredInfo:JSON.stringify(s),attachments:JSON.stringify(U),packageName:t?.name,packagePrice:t?.price,packageSlaHours:t?.slaHours??void 0});j.success("تم حجز الاستشارة بنجاح!"),H(`/consultation/${r.bookingId}`)}catch(s){j.error(s.message||"فشل حجز الاستشارة")}},xe=["09:00","10:00","11:00","12:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"],T=new Date;T.setDate(T.getDate()+1);const ue=T.toISOString().split("T")[0];return n.useEffect(()=>{x&&localStorage.setItem("rabit-preferred-type",String(x))},[x]),n.useEffect(()=>{u&&localStorage.setItem("rabit-last-consultant",String(u))},[u]),n.useEffect(()=>{d&&m&&localStorage.setItem("rabit-last-slot",JSON.stringify({date:d,time:m}))},[d,m]),re?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-12",children:e.jsx("div",{className:"container max-w-4xl",children:e.jsx(ee,{className:"h-64 w-full"})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-12",children:e.jsxs("div",{className:"container max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full ${i>=s?"bg-purple-600 text-white":"bg-gray-200 text-gray-500"}`,children:i>s?e.jsx(f,{className:"h-5 w-5"}):s}),s<4&&e.jsx("div",{className:`flex-1 h-1 mx-2 ${i>s?"bg-purple-600":"bg-gray-200"}`})]},s))}),e.jsxs("div",{className:"flex justify-between mt-2 text-sm",children:[e.jsx("span",{className:i>=1?"text-purple-600 font-medium":"text-gray-500",children:"نوع الاستشارة"}),e.jsx("span",{className:i>=2?"text-purple-600 font-medium":"text-gray-500",children:"المستشار"}),e.jsx("span",{className:i>=3?"text-purple-600 font-medium":"text-gray-500",children:"الموعد والمتطلبات"}),e.jsx("span",{className:i>=4?"text-purple-600 font-medium":"text-gray-500",children:"التأكيد"})]})]}),t&&e.jsx(g,{className:"mb-6 border-green-200 bg-green-50/80",children:e.jsxs(Ne,{className:"py-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(Se,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-green-800",children:t.name||"باقة استشارية"}),typeof t.price=="number"&&e.jsxs(be,{variant:"secondary",className:"bg-white text-green-700",children:[t.price," ريال"]})]}),t.slaHours?e.jsxs("p",{className:"text-sm text-green-700",children:["SLA ",t.slaHours," ساعة • لن يتم تحصيل الدفع الآن"]}):e.jsx("p",{className:"text-sm text-green-700",children:"لن يتم تحصيل الدفع الآن"})]})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>{localStorage.removeItem("rabit-consulting-package"),D(null)},children:"إزالة"})]})}),e.jsxs(g,{className:"p-8",children:[i===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ve,{className:"h-12 w-12 text-purple-600 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold",children:"اختر نوع الاستشارة"}),e.jsx("p",{className:"text-muted-foreground",children:"حدد نوع الاستشارة التي تحتاجها"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:E?.types?.map(s=>e.jsxs(g,{className:`p-4 cursor-pointer transition-all hover:shadow-lg ${x===s.id?"border-2 border-purple-600 bg-purple-50":""}`,onClick:()=>P(s.id),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold",children:s.nameAr}),x===s.id&&e.jsx(f,{className:"h-5 w-5 text-purple-600"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:s.descriptionAr}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:[s.price," ريال"]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"block text-sm text-muted-foreground",children:[s.duration," دقيقة"]}),e.jsxs("span",{className:"block text-xs text-green-600",children:["SLA: ",s.slaHours||24," ساعة"]})]})]})]},s.id))}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{onClick:()=>h(2),disabled:!x,className:"bg-purple-600 hover:bg-purple-700",children:["التالي",e.jsx(L,{className:"mr-2 h-4 w-4"})]})})]}),i===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(Z,{className:"h-12 w-12 text-purple-600 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold",children:"اختر المستشار"}),e.jsx("p",{className:"text-muted-foreground",children:"حدد المستشار المناسب لك"})]}),ne?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(ee,{className:"h-24 w-full"},s))}):e.jsx("div",{className:"space-y-4",children:J?.consultants?.map(s=>e.jsx(g,{className:`p-4 cursor-pointer transition-all hover:shadow-lg ${u===s.id?"border-2 border-purple-600 bg-purple-50":""}`,onClick:()=>C(s.id),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"h-8 w-8 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:s.fullNameAr}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.yearsOfExperience," سنوات خبرة"]})]}),u===s.id&&e.jsx(f,{className:"h-5 w-5 text-purple-600"})]}),e.jsx("p",{className:"text-sm mt-2 line-clamp-2",children:s.bioAr})]})]})},s.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(p,{onClick:()=>h(1),variant:"outline",children:[e.jsx(B,{className:"ml-2 h-4 w-4"}),"السابق"]}),e.jsxs(p,{onClick:()=>h(3),disabled:!u,className:"bg-purple-600 hover:bg-purple-700",children:["التالي",e.jsx(L,{className:"mr-2 h-4 w-4"})]})]})]}),i===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(fe,{className:"h-12 w-12 text-purple-600 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold",children:"الموعد والمتطلبات"}),e.jsx("p",{className:"text-muted-foreground",children:"حدد الموعد وأرفق المستندات المطلوبة"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"التاريخ *"}),e.jsx(A,{type:"date",value:d,onChange:s=>O(s.target.value),min:ue,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"الوقت *"}),e.jsxs(K,{value:m,onValueChange:R,children:[e.jsx(W,{className:"mt-1",children:e.jsx(X,{placeholder:"اختر الوقت"})}),e.jsx(Y,{children:xe.map(s=>e.jsx(_,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"عنوان مختصر"}),e.jsx(A,{value:F,onChange:s=>ae(s.target.value),placeholder:"مثال: مراجعة عقد عمل لموظف جديد",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"وصف المشكلة أو الاستفسار *"}),e.jsx(G,{value:k,onChange:s=>te(s.target.value),placeholder:"اشرح بالتفصيل ما تحتاج مساعدة فيه...",rows:4,className:"mt-1"})]}),Q.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"معلومات مطلوبة"]}),Q.map((s,r)=>e.jsxs("div",{children:[e.jsxs(N,{children:[s.nameAr," ",s.required&&"*"]}),s.type==="textarea"?e.jsx(G,{value:b[s.nameAr]||"",onChange:a=>I(c=>({...c,[s.nameAr]:a.target.value})),placeholder:s.nameAr,rows:3,className:"mt-1"}):s.type==="select"&&s.options?e.jsxs(K,{value:b[s.nameAr]||"",onValueChange:a=>I(c=>({...c,[s.nameAr]:a})),children:[e.jsx(W,{className:"mt-1",children:e.jsx(X,{placeholder:`اختر ${s.nameAr}`})}),e.jsx(Y,{children:s.options.map(a=>e.jsx(_,{value:a,children:a},a))})]}):e.jsx(A,{type:s.type,value:b[s.nameAr]||"",onChange:a=>I(c=>({...c,[s.nameAr]:a.target.value})),placeholder:s.nameAr,className:"mt-1"})]},r))]}),V.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"المستندات المطلوبة"]}),V.map((s,r)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs(N,{className:"text-base",children:[s.nameAr," ",s.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]})}),e.jsx(A,{type:"file",onChange:a=>me(a,s.nameAr),accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",className:"mt-2"}),U.find(a=>a.name===s.nameAr)&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-green-600",children:[e.jsx(f,{className:"h-4 w-4"}),"تم الرفع بنجاح"]})]},r))]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(p,{onClick:()=>h(2),variant:"outline",children:[e.jsx(B,{className:"ml-2 h-4 w-4"}),"السابق"]}),e.jsxs(p,{onClick:()=>h(4),disabled:!d||!m||!k,className:"bg-purple-600 hover:bg-purple-700",children:["التالي",e.jsx(L,{className:"mr-2 h-4 w-4"})]})]})]}),i===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(f,{className:"h-12 w-12 text-purple-600 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold",children:"تأكيد الحجز"}),e.jsx("p",{className:"text-muted-foreground",children:"راجع تفاصيل حجزك قبل التأكيد"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(g,{className:"p-4 bg-purple-50",children:[e.jsx("h3",{className:"font-bold mb-3",children:"ملخص الحجز"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نوع الاستشارة:"}),e.jsx("span",{className:"font-medium",children:M})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المستشار:"}),e.jsx("span",{className:"font-medium",children:ie?.fullNameAr})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"التاريخ:"}),e.jsx("span",{className:"font-medium",children:d})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الوقت:"}),e.jsx("span",{className:"font-medium",children:m})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المدة:"}),e.jsxs("span",{className:"font-medium",children:[l?.estimatedDuration||l?.duration," دقيقة"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"SLA:"}),e.jsxs("span",{className:"font-medium",children:[v," ساعة"]})]}),t&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الباقة:"}),e.jsx("span",{className:"font-medium",children:$})]}),!t&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الباقة:"}),e.jsx("span",{className:"font-medium",children:"أساسي"})]}),e.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between text-lg",children:[e.jsx("span",{className:"font-bold",children:"الإجمالي:"}),e.jsxs("span",{className:"font-bold text-purple-600",children:[de," ريال"]})]}),t&&e.jsxs("div",{className:"text-xs text-green-700 mt-1",children:["سيتم تطبيق باقة ",t.name," دون تحصيل فوري"]}),!t&&e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"لم تختر باقة محددة؛ سيتم تأكيد السعر بعد مراجعة الاستشارة."}),z&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"تسليم متوقع:"}),e.jsx("span",{className:"font-medium",children:z})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3",children:[e.jsx(we,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 mb-1",children:"ملاحظة مهمة"}),e.jsx("p",{className:"text-blue-700",children:"سيتم التواصل معك عبر لوحة الاستشارة بعد التأكيد. يرجى متابعة الرسائل بانتظام. لن يتم تحصيل الدفع الآن. سيتم تأكيد السعر والبنود عند مراجعة الباقة المختارة."})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(p,{onClick:()=>h(3),variant:"outline",children:[e.jsx(B,{className:"ml-2 h-4 w-4"}),"السابق"]}),e.jsxs(p,{onClick:oe,disabled:q.isPending,className:"bg-purple-600 hover:bg-purple-700",children:[q.isPending?"جاري الحجز...":"تأكيد الحجز",e.jsx(f,{className:"mr-2 h-4 w-4"})]})]})]})]})]})})}export{Je as default};
