import{x as X,y as Y,r as n,j as e,z as Z,A as T,B as U,D as S,E as k,F as V,O as R}from"./ui-vendor-C96WIwkg.js";import{n as d,m as _,t as j,b as l,k as C,C as x,c as ee,d as se,e as ae,D as ie,z as te,B as m,v as re,w as le,x as ne,A as de,I as g,E as ce,f as h,j as oe}from"./index-Bkz6h1fQ.js";import{L as p}from"./label-CmhXhWbA.js";import{B as b}from"./badge-DdDRUR73.js";import{S as xe,a as me,b as ue,c as he,d as w}from"./select-B0y6YODy.js";import{P as D}from"./plus-0j2KamQO.js";import{T as A}from"./tag-D3Y8_vCl.js";import{T as pe}from"./trending-up-Bx2v0sIc.js";import{T as je}from"./trash-2-Dqtod12U.js";import"./react-vendor-DDxydHEc.js";import"./query-vendor-Dpt6u7bR.js";import"./chart-vendor-8DIN3ZwM.js";const ge=X,fe=Y,ve=Z,E=n.forwardRef(({className:a,...i},r)=>e.jsx(R,{ref:r,className:d("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm transition-opacity",a),...i}));E.displayName=R.displayName;const M=n.forwardRef(({className:a,children:i,...r},c)=>e.jsxs(ve,{children:[e.jsx(E,{}),e.jsx(T,{ref:c,className:d("fixed left-1/2 top-1/2 z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 sm:rounded-lg","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-primary",a),...r,children:i})]}));M.displayName=T.displayName;const F=({className:a,...i})=>e.jsx("div",{className:d("flex flex-col space-y-2 text-center sm:text-left",a),...i});F.displayName="AlertDialogHeader";const P=({className:a,...i})=>e.jsx("div",{className:d("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...i});P.displayName="AlertDialogFooter";const z=n.forwardRef(({className:a,...i},r)=>e.jsx(U,{ref:r,className:d("text-lg font-semibold",a),...i}));z.displayName=U.displayName;const L=n.forwardRef(({className:a,...i},r)=>e.jsx(S,{ref:r,className:d("text-sm text-muted-foreground",a),...i}));L.displayName=S.displayName;const O=n.forwardRef(({className:a,...i},r)=>e.jsx(V,{ref:r,className:d("inline-flex h-10 items-center justify-center rounded-md bg-destructive text-destructive-foreground px-4 py-2 text-sm font-medium transition-colors hover:bg-destructive/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",a),...i}));O.displayName=V.displayName;const B=n.forwardRef(({className:a,...i},r)=>e.jsx(k,{ref:r,className:d("inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium shadow-sm transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",a),...i}));B.displayName=k.displayName;function Re(){const{user:a,loading:i}=_(),[r,c]=n.useState(!1),[t,o]=n.useState({code:"",description:"",discountType:"percentage",discountValue:10,maxUses:void 0,validFrom:void 0,validUntil:void 0}),{data:I,isLoading:H,refetch:f}=j.discountCodes.getAll.useQuery(void 0,{enabled:a?.role==="admin"}),u=I?.codes||[],v=j.discountCodes.create.useMutation({onSuccess:()=>{l.success("تم إنشاء الكود بنجاح"),c(!1),Q(),f()},onError:s=>{l.error("فشل إنشاء الكود: "+s.message)}}),$=j.discountCodes.delete.useMutation({onSuccess:()=>{l.success("تم حذف الكود بنجاح"),f()},onError:s=>{l.error("فشل حذف الكود: "+s.message)}}),y=j.discountCodes.update.useMutation({onSuccess:()=>{l.success("تم تحديث الكود بنجاح"),f()},onError:s=>{l.error("فشل تحديث الكود: "+s.message)}}),Q=()=>{o({code:"",description:"",discountType:"percentage",discountValue:10,maxUses:void 0,validFrom:void 0,validUntil:void 0})},q=()=>{if(!t.code.trim()){l.error("الرجاء إدخال الكود");return}if(t.discountValue<=0){l.error("قيمة الخصم يجب أن تكون أكبر من صفر");return}if(t.discountType==="percentage"&&t.discountValue>100){l.error("نسبة الخصم يجب ألا تتجاوز 100%");return}v.mutate(t)},G=(s,N)=>{y.mutate({id:s,isActive:!N})};if(i||H)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"})});if(!a||a.role!=="admin")return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(x,{className:"max-w-md",children:e.jsxs(ee,{children:[e.jsx(se,{children:"غير مصرح"}),e.jsx(ae,{children:"هذه الصفحة مخصصة للمديرين فقط"})]})})});const J=u.length,K=u.filter(s=>s.isActive).length,W=u.reduce((s,N)=>s+(N.usedCount||0),0);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-8 px-4",children:e.jsxs("div",{className:"container max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"إدارة أكواد الخصم"}),e.jsx("p",{className:"text-muted-foreground",children:"إنشاء وإدارة أكواد الخصم للاشتراكات"})]}),e.jsxs(ie,{open:r,onOpenChange:c,children:[e.jsx(te,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(D,{className:"ml-2 h-4 w-4"}),"كود جديد"]})}),e.jsxs(re,{className:"max-w-md",children:[e.jsxs(le,{children:[e.jsx(ne,{children:"إنشاء كود خصم جديد"}),e.jsx(de,{children:"أضف كود خصم جديد للاشتراكات"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"الكود *"}),e.jsx(g,{placeholder:"SUMMER2024",value:t.code,onChange:s=>o({...t,code:s.target.value.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx(p,{children:"الوصف"}),e.jsx(g,{placeholder:"خصم الصيف",value:t.description,onChange:s=>o({...t,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(p,{children:"نوع الخصم *"}),e.jsxs(xe,{value:t.discountType,onValueChange:s=>o({...t,discountType:s}),children:[e.jsx(me,{children:e.jsx(ue,{})}),e.jsxs(he,{children:[e.jsx(w,{value:"percentage",children:"نسبة مئوية (%)"}),e.jsx(w,{value:"fixed",children:"مبلغ ثابت (﷼)"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"قيمة الخصم *"}),e.jsx(g,{type:"number",min:"1",max:t.discountType==="percentage"?100:void 0,value:t.discountValue,onChange:s=>o({...t,discountValue:parseInt(s.target.value)||0})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.discountType==="percentage"?"نسبة الخصم (1-100%)":"المبلغ بالريال السعودي"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"الحد الأقصى للاستخدام"}),e.jsx(g,{type:"number",min:"1",placeholder:"غير محدود",value:t.maxUses||"",onChange:s=>o({...t,maxUses:s.target.value?parseInt(s.target.value):void 0})})]})]}),e.jsxs(ce,{children:[e.jsx(m,{variant:"outline",onClick:()=>c(!1),children:"إلغاء"}),e.jsx(m,{onClick:q,disabled:v.isPending,children:v.isPending?e.jsx(C,{className:"h-4 w-4 animate-spin"}):"إنشاء"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(A,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الأكواد"}),e.jsx("p",{className:"text-2xl font-bold",children:J})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(pe,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"أكواد نشطة"}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx(oe,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"مرات الاستخدام"}),e.jsx("p",{className:"text-2xl font-bold",children:W})]})]})})})]})]}),u.length===0?e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"لا توجد أكواد خصم"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"ابدأ بإنشاء كود خصم جديد"}),e.jsxs(m,{onClick:()=>c(!0),children:[e.jsx(D,{className:"ml-2 h-4 w-4"}),"إنشاء كود جديد"]})]})}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.map(s=>e.jsx(x,{className:s.isActive?"":"opacity-60",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(b,{variant:"secondary",className:"font-mono text-lg px-3 py-1",children:s.code}),e.jsx(b,{variant:s.isActive?"default":"secondary",children:s.isActive?"نشط":"غير نشط"}),s.maxUses&&e.jsxs(b,{variant:"outline",children:[s.usedCount,"/",s.maxUses," استخدام"]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الخصم: "}),e.jsx("span",{className:"font-semibold",children:s.discountType==="percentage"?`${s.discountValue}%`:`${s.discountValue} ﷼`})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground",children:["الاستخدام:"," "]}),e.jsxs("span",{className:"font-semibold",children:[s.usedCount||0," ",s.maxUses?`/ ${s.maxUses}`:""]})]}),s.validUntil&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground",children:["ينتهي:"," "]}),e.jsx("span",{className:"font-semibold",children:new Date(s.validUntil).toLocaleDateString("ar-SA")})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>G(s.id,s.isActive),disabled:y.isPending,children:s.isActive?"تعطيل":"تفعيل"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",className:"text-red-600",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(z,{children:"هل أنت متأكد؟"}),e.jsxs(L,{children:['سيتم حذف كود الخصم "',s.code,'" نهائياً']})]}),e.jsxs(P,{children:[e.jsx(B,{children:"إلغاء"}),e.jsx(O,{onClick:()=>$.mutate({id:s.id}),className:"bg-red-600 hover:bg-red-700",children:"حذف"})]})]})]})]})]})})},s.id))})]})})}export{Re as default};
