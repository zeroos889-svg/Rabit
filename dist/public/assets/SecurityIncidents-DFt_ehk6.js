import{r as i,j as e}from"./ui-vendor-C96WIwkg.js";import{m as G,a as J,t as u,b as j,D as K,z as W,B as m,v as X,w as Y,x as Z,A as _,I,C as l,f as n,c as ee,d as se,T as te,j as ae,p as k}from"./index-Bkz6h1fQ.js";import{B as d}from"./badge-DdDRUR73.js";import{T as U}from"./textarea-CDZ7LSXO.js";import{L as o}from"./label-CmhXhWbA.js";import{S as re,a as le,b as ne,c as ie,d as g}from"./select-B0y6YODy.js";import{P as ce}from"./plus-0j2KamQO.js";import{S as de}from"./shield-D1nyOWBv.js";import{C as P}from"./circle-check-big-BG0Kvuh6.js";import{C as oe}from"./circle-alert-BSV6M1IC.js";import"./react-vendor-DDxydHEc.js";import"./query-vendor-Dpt6u7bR.js";import"./chart-vendor-8DIN3ZwM.js";function Se(){const{user:p,loading:B}=G(),[,H]=J(),[M,f]=i.useState(!1),[x,N]=i.useState(""),[b,v]=i.useState(""),[w,C]=i.useState(""),[h,S]=i.useState(""),[T,D]=i.useState("medium"),{data:a,isLoading:F,refetch:A}=u.adminPdpl.getIncidents.useQuery(),y=u.adminPdpl.createIncident.useMutation({onSuccess:()=>{j.success("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­"),f(!1),R(),A()}}),L=u.adminPdpl.updateIncident.useMutation({onSuccess:()=>{j.success("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­"),A()}}),R=()=>{N(""),v(""),C(""),S(""),D("medium")},z=()=>{if(!x){j.error("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ø­Ø§Ø¯Ø«");return}y.mutate({description:x,cause:b||void 0,affectedDataCategories:w||void 0,affectedUsersCount:h?parseInt(h):void 0,riskLevel:T})},O=s=>{confirm("Ù‡Ù„ ØªÙ… Ø¥Ø¨Ù„Ø§Øº Ø³Ø¯Ø§ÙŠØ§ ÙØ¹Ù„ÙŠØ§Ù‹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø§Ø¯Ø«ØŸ")&&L.mutate({incidentId:s,reportedToSdaiaAt:new Date,status:"reported"})},E=s=>{confirm("Ù‡Ù„ ØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†ØŸ")&&L.mutate({incidentId:s,reportedToUsersAt:new Date})};if(B||F)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!p||p.role!=="admin")return H("/"),null;const V=s=>{const t={low:{variant:"secondary",label:"Ù…Ù†Ø®ÙØ¶",className:"bg-green-100 text-green-800"},medium:{variant:"default",label:"Ù…ØªÙˆØ³Ø·",className:"bg-amber-100 text-amber-800"},high:{variant:"destructive",label:"Ø¹Ø§Ù„ÙŠ",className:"bg-red-100 text-red-800"}},r=t[s]||t.medium;return e.jsx(d,{className:r.className,children:r.label})},Q=s=>{const t={new:{label:"Ø¬Ø¯ÙŠØ¯",className:"bg-blue-100 text-blue-800"},investigating:{label:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚",className:"bg-purple-100 text-purple-800"},reported:{label:"ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº",className:"bg-amber-100 text-amber-800"},resolved:{label:"Ù…Ø­Ù„ÙˆÙ„",className:"bg-green-100 text-green-800"}},r=t[s]||t.new;return e.jsx(d,{className:r.className,children:r.label})},$=s=>{const t=new Date(s),c=72-Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60));return c<0?e.jsxs("span",{className:"text-red-600 font-semibold",children:["Ù…ØªØ£Ø®Ø± ",Math.abs(c)," Ø³Ø§Ø¹Ø© âš ï¸"]}):c<=12?e.jsxs("span",{className:"text-amber-600 font-semibold",children:["Ù…ØªØ¨Ù‚ÙŠ ",c," Ø³Ø§Ø¹Ø©"]}):e.jsxs("span",{className:"text-muted-foreground",children:["Ù…ØªØ¨Ù‚ÙŠ ",c," Ø³Ø§Ø¹Ø©"]})};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 py-12 px-4",children:e.jsxs("div",{className:"container max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent mb-2",children:"Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø¥Ø¯Ø§Ø±Ø© Ø®Ø±ÙˆÙ‚Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø©)"})]}),e.jsxs(K,{open:M,onOpenChange:f,children:[e.jsx(W,{asChild:!0,children:e.jsxs(m,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯"]})}),e.jsxs(X,{className:"max-w-2xl",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø« Ø£Ù…Ù†ÙŠ Ø¬Ø¯ÙŠØ¯"}),e.jsx(_,{children:"Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø­Ø§Ø¯Ø«. Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ù€ 72 Ø³Ø§Ø¹Ø© ÙÙˆØ±Ø§Ù‹."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"ÙˆØµÙ Ø§Ù„Ø­Ø§Ø¯Ø« *"}),e.jsx(U,{id:"description",placeholder:"Ø§Ø´Ø±Ø­ Ù…Ø§ Ø­Ø¯Ø« Ø¨Ø§Ù„ØªÙØµÙŠÙ„...",value:x,onChange:s=>N(s.target.value),rows:4})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"cause",children:"Ø§Ù„Ø³Ø¨Ø¨ (Ø¥Ù† ÙƒØ§Ù† Ù…Ø¹Ø±ÙˆÙØ§Ù‹)"}),e.jsx(U,{id:"cause",placeholder:"Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ³Ø¨Ø¨ ÙÙŠ Ø§Ù„Ø­Ø§Ø¯Ø«ØŸ",value:b,onChange:s=>v(s.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"categories",children:"ÙØ¦Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©"}),e.jsx(I,{id:"categories",placeholder:"Ù…Ø«Ø§Ù„: Ø£Ø³Ù…Ø§Ø¡ØŒ Ø£Ø±Ù‚Ø§Ù… Ù‡ÙˆØ§ØªÙØŒ Ø¹Ù†Ø§ÙˆÙŠÙ†",value:w,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"usersCount",children:"Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ† (ØªÙ‚Ø±ÙŠØ¨ÙŠ)"}),e.jsx(I,{id:"usersCount",type:"number",placeholder:"0",value:h,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"riskLevel",children:"Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø© *"}),e.jsxs(re,{value:T,onValueChange:s=>D(s),children:[e.jsx(le,{children:e.jsx(ne,{})}),e.jsxs(ie,{children:[e.jsx(g,{value:"low",children:"Ù…Ù†Ø®ÙØ¶"}),e.jsx(g,{value:"medium",children:"Ù…ØªÙˆØ³Ø·"}),e.jsx(g,{value:"high",children:"Ø¹Ø§Ù„ÙŠ"})]})]})]}),e.jsx(m,{onClick:z,disabled:y.isPending,className:"w-full",children:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ø¯Ø«"})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-red-600",children:a?.incidents?.filter(s=>{const t=new Date(s.detectedAt);return Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60))>72&&!s.reportedToSdaiaAt}).length||0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Ù…ØªØ£Ø®Ø±Ø© (72+ Ø³Ø§Ø¹Ø©)"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:a?.incidents?.filter(s=>s.status==="investigating").length||0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:a?.incidents?.filter(s=>s.status==="reported").length||0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:a?.incidents?.filter(s=>s.status==="resolved").length||0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Ù…Ø­Ù„ÙˆÙ„Ø©"})]})})})]}),e.jsxs(l,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«"})}),e.jsx(n,{children:!a?.incidents||a.incidents.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ÙˆØ§Ø¯Ø« Ù…Ø³Ø¬Ù„Ø© (Ù‡Ø°Ø§ Ø¬ÙŠØ¯! ğŸ‰)"})]}):e.jsx("div",{className:"space-y-4",children:a.incidents.map(s=>e.jsx(l,{className:`border-2 ${s.isLate?"border-red-300 bg-red-50":""}`,children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"h-5 w-5 text-red-600"}),e.jsxs("h3",{className:"font-semibold",children:["Ø­Ø§Ø¯Ø« #",s.id]}),V(s.riskLevel),Q(s.status),s.isLate&&e.jsx(d,{className:"bg-red-600 text-white",children:"Ù…ØªØ£Ø®Ø±!"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),s.cause&&e.jsxs("p",{className:"text-sm bg-slate-100 p-2 rounded",children:[e.jsx("strong",{children:"Ø§Ù„Ø³Ø¨Ø¨:"})," ",s.cause]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.detectedAt).toLocaleString("ar-SA")}),!s.reportedToSdaiaAt&&e.jsx("p",{className:"text-sm",children:$(s.detectedAt)})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:s.affectedUsersCount&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[s.affectedUsersCount," Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ£Ø«Ø±"]})]})}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t",children:[!s.reportedToSdaiaAt&&e.jsxs(m,{size:"sm",onClick:()=>O(s.id),className:"bg-red-600 hover:bg-red-700",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Ø¥Ø¨Ù„Ø§Øº Ø³Ø¯Ø§ÙŠØ§"]}),s.reportedToSdaiaAt&&!s.reportedToUsersAt&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>E(s.id),children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"]}),s.reportedToSdaiaAt&&e.jsxs(d,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù„Ø³Ø¯Ø§ÙŠØ§"]}),s.reportedToUsersAt&&e.jsxs(d,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"ØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"]})]})]})})},s.id))})})]}),e.jsx(l,{className:"mt-6 bg-red-50 border-red-200",children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-2 text-sm text-red-900",children:[e.jsx("p",{className:"font-semibold",children:"ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù… - Ù…ØªØ·Ù„Ø¨Ø§Øª PDPL:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 mr-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"72 Ø³Ø§Ø¹Ø©:"})," ÙŠØ¬Ø¨ Ø¥Ø¨Ù„Ø§Øº Ø³Ø¯Ø§ÙŠØ§ Ø¹Ù† Ø£ÙŠ Ø®Ø±Ù‚ Ø®Ù„Ø§Ù„ 72 Ø³Ø§Ø¹Ø© Ù…Ù† Ø§ÙƒØªØ´Ø§ÙÙ‡"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ†:"})," ÙŠØ¬Ø¨ Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ† Ø¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ± ØºÙŠØ± Ù…Ø¨Ø±Ø±"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ø§Ù„ØªÙˆØ«ÙŠÙ‚:"})," ÙŠØ¬Ø¨ ØªÙˆØ«ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø±ÙˆÙ‚Ø§Øª Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ØªØªØ·Ù„Ø¨ Ø¥Ø¨Ù„Ø§Øº Ø³Ø¯Ø§ÙŠØ§"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª:"})," Ø§Ù„ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‚Ø¯ ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØµØ© Ù„ØºØ±Ø§Ù…Ø§Øª ÙƒØ¨ÙŠØ±Ø©"]})]})]})]})})})]})})}export{Se as default};
