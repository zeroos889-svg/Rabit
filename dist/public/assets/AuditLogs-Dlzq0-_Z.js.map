{"version":3,"file":"AuditLogs-Dlzq0-_Z.js","sources":["../../../client/src/pages/admin/AuditLogs.tsx"],"sourcesContent":["import { useMemo, useState } from \"react\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { AlertTriangle, Clock, Download, Filter, Shield, User } from \"lucide-react\";\n\ntype LogItem = {\n  id: number;\n  actor: string;\n  action: string;\n  entity: string;\n  severity: \"info\" | \"warn\" | \"error\";\n  timestamp: string;\n  ip: string;\n};\n\nconst initialLogs: LogItem[] = [\n  {\n    id: 1,\n    actor: \"admin@rabit.com\",\n    action: \"تحديث صلاحيات مستخدم\",\n    entity: \"user: 104\",\n    severity: \"info\",\n    timestamp: \"2025-01-20 10:25\",\n    ip: \"192.168.1.12\",\n  },\n  {\n    id: 2,\n    actor: \"security@rabit.com\",\n    action: \"محاولة تسجيل دخول فاشلة\",\n    entity: \"admin@demo\",\n    severity: \"warn\",\n    timestamp: \"2025-01-20 09:40\",\n    ip: \"10.0.0.3\",\n  },\n  {\n    id: 3,\n    actor: \"ops@rabit.com\",\n    action: \"حذف تذكرة دعم\",\n    entity: \"ticket: 552\",\n    severity: \"error\",\n    timestamp: \"2025-01-19 18:10\",\n    ip: \"172.16.1.8\",\n  },\n];\n\nexport default function AdminAuditLogs() {\n  const [logs] = useState<LogItem[]>(initialLogs);\n  const [severity, setSeverity] = useState<\"all\" | \"info\" | \"warn\" | \"error\">(\"all\");\n  const [search, setSearch] = useState(\"\");\n\n  const filtered = useMemo(() => {\n    return logs.filter(log => {\n      if (severity !== \"all\" && log.severity !== severity) return false;\n      if (search && !log.action.includes(search) && !log.actor.includes(search)) return false;\n      return true;\n    });\n  }, [logs, severity, search]);\n\n  const stats = useMemo(() => {\n    return {\n      total: logs.length,\n      warn: logs.filter(l => l.severity === \"warn\").length,\n      error: logs.filter(l => l.severity === \"error\").length,\n    };\n  }, [logs]);\n\n  return (\n    <div className=\"p-6 space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">سجلات التدقيق</h1>\n            <p className=\"text-muted-foreground\">\n              مراقبة التغييرات، محاولات الدخول، والعمليات الحساسة.\n            </p>\n          </div>\n          <Button variant=\"outline\">\n            <Download className=\"h-4 w-4 ml-2\" />\n            تصدير CSV\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardContent className=\"p-4 flex items-center gap-3\">\n              <Shield className=\"h-6 w-6 text-purple-600\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">إجمالي الأحداث</p>\n                <p className=\"text-2xl font-bold\">{stats.total}</p>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4 flex items-center gap-3\">\n              <AlertTriangle className=\"h-6 w-6 text-amber-600\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">تحذيرات</p>\n                <p className=\"text-2xl font-bold\">{stats.warn}</p>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4 flex items-center gap-3\">\n              <Clock className=\"h-6 w-6 text-red-600\" />\n              <div>\n                <p className=\"text-sm text-muted-foreground\">أخطاء حرجة</p>\n                <p className=\"text-2xl font-bold\">{stats.error}</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>سجل النشاطات</CardTitle>\n            <CardDescription>فلترة حسب الخطورة أو البحث عن مستخدم/حدث</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex flex-wrap gap-3 items-center\">\n              <Select value={severity} onValueChange={val => setSeverity(val as any)}>\n                <SelectTrigger className=\"w-48\">\n                  <SelectValue placeholder=\"الخطورة\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">الكل</SelectItem>\n                  <SelectItem value=\"info\">معلوماتي</SelectItem>\n                  <SelectItem value=\"warn\">تحذيري</SelectItem>\n                  <SelectItem value=\"error\">حرج</SelectItem>\n                </SelectContent>\n              </Select>\n              <div className=\"flex items-center gap-2 w-full md:w-72\">\n                <Filter className=\"h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"بحث في الأحداث أو المستخدم\"\n                  value={search}\n                  onChange={e => setSearch(e.target.value)}\n                />\n              </div>\n            </div>\n\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-right\">المستخدم</TableHead>\n                  <TableHead className=\"text-right\">الإجراء</TableHead>\n                  <TableHead className=\"text-right\">الكائن</TableHead>\n                  <TableHead className=\"text-right\">الوقت</TableHead>\n                  <TableHead className=\"text-right\">IP</TableHead>\n                  <TableHead className=\"text-right\">الحالة</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filtered.map(log => (\n                  <TableRow key={log.id}>\n                    <TableCell className=\"font-medium flex items-center gap-2\">\n                      <User className=\"h-4 w-4 text-purple-600\" />\n                      {log.actor}\n                    </TableCell>\n                    <TableCell>{log.action}</TableCell>\n                    <TableCell>\n                      <Badge variant=\"outline\">{log.entity}</Badge>\n                    </TableCell>\n                    <TableCell>{log.timestamp}</TableCell>\n                    <TableCell>{log.ip}</TableCell>\n                    <TableCell>\n                      <Badge\n                        className={\n                          log.severity === \"error\"\n                            ? \"bg-red-100 text-red-700\"\n                            : log.severity === \"warn\"\n                            ? \"bg-amber-100 text-amber-700\"\n                            : \"bg-slate-100 text-slate-700\"\n                        }\n                      >\n                        {log.severity}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n  );\n}\n"],"names":["initialLogs","AdminAuditLogs","logs","useState","severity","setSeverity","search","setSearch","filtered","useMemo","log","stats","l","jsxs","jsx","Button","Download","Card","CardContent","Shield","AlertTriangle","Clock","CardHeader","CardTitle","CardDescription","Select","val","SelectTrigger","SelectValue","SelectContent","SelectItem","Filter","Input","e","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","User","Badge"],"mappings":"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"}