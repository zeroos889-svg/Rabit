{"version":3,"file":"MyDocuments-CB7fKzNg.js","sources":["../../../client/src/pages/MyDocuments.tsx"],"sourcesContent":["import { useMemo, useState } from \"react\";\nimport type { ComponentProps } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Bookmark, Download, Eye, FileText, Loader2, RefreshCw, Search, Trash2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/_core/hooks/useAuth\";\nimport { trpc } from \"@/lib/trpc\";\nimport type { inferRouterOutputs } from \"@trpc/server\";\nimport type { AppRouter } from \"../../../server/routers\";\n\nconst MAX_DOCUMENTS = 200;\nconst RECENT_WINDOW_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\nconst SAFE_TITLE_REGEX = /[^0-9A-Za-z\\u0600-\\u06FF\\s-_]/g;\n\ntype RouterOutputs = inferRouterOutputs<AppRouter>;\ntype GeneratedDocument = RouterOutputs[\"documentGenerator\"][\"getMyDocuments\"][\"documents\"][number];\ntype FilterTab = \"all\" | \"saved\" | \"draft\";\n\nconst formatDate = (value?: string | Date | null) => {\n  if (!value) return \"—\";\n  try {\n    const date = typeof value === \"string\" ? new Date(value) : value;\n    if (Number.isNaN(date.getTime())) return \"—\";\n    return date.toLocaleDateString(\"ar-SA\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n    });\n  } catch {\n    return \"—\";\n  }\n};\n\nconst isSavedDocument = (doc: GeneratedDocument) => Boolean(doc.isSaved ?? doc.saved);\n\nconst formatTemplateCode = (code: string) =>\n  code\n    .split(/[-_]/)\n    .filter(Boolean)\n    .map(part => part.charAt(0).toUpperCase() + part.slice(1))\n    .join(\" \");\n\nconst getDocTitle = (doc: GeneratedDocument) => {\n  if (doc.title && doc.title.trim().length > 0) return doc.title;\n  if (doc.companyName) return `${doc.companyName} - ${doc.templateCode ?? \"مستند\"}`;\n  if (doc.templateCode) return formatTemplateCode(doc.templateCode);\n  return `مستند رقم ${doc.id}`;\n};\n\nconst getDocSnippet = (doc: GeneratedDocument, maxLength = 140) => {\n  const raw = doc.outputText || doc.content || doc.outputHtml || \"\";\n  const plain = typeof raw === \"string\" ? raw.replace(/<[^>]+>/g, \" \").replace(/\\s+/g, \" \") : \"\";\n  if (!plain) return \"—\";\n  return plain.length > maxLength ? `${plain.slice(0, maxLength)}…` : plain;\n};\n\ntype DialogControlProps = Pick<ComponentProps<typeof Dialog>, \"open\" | \"onOpenChange\">;\n\ntype PreviewDialogProps = DialogControlProps & {\n  document: GeneratedDocument | null;\n};\n\nconst DocumentPreviewDialog = ({ document, open, onOpenChange }: PreviewDialogProps) => {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3xl\">\n        <DialogHeader>\n          <DialogTitle>{document ? getDocTitle(document) : \"معاينة المستند\"}</DialogTitle>\n        </DialogHeader>\n        {document ? (\n          <ScrollArea className=\"max-h-[60vh] rounded-lg border bg-white/50 p-6\">\n            {document.outputHtml ? (\n              <div\n                className=\"space-y-4 text-right leading-relaxed\"\n                dangerouslySetInnerHTML={{ __html: document.outputHtml }}\n              />\n            ) : (\n              <pre className=\"whitespace-pre-wrap text-sm text-right leading-relaxed\">{document.outputText ?? document.content ?? \"لا توجد بيانات لعرضها\"}</pre>\n            )}\n          </ScrollArea>\n        ) : (\n          <div className=\"text-center text-muted-foreground\">لا يوجد مستند محدد</div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default function MyDocuments() {\n  const { isAuthenticated } = useAuth();\n  const [, navigate] = useLocation();\n  const utils = trpc.useUtils();\n  const documentsQueryInput = { limit: MAX_DOCUMENTS } as const;\n  const [tab, setTab] = useState<FilterTab>(\"all\");\n  const [search, setSearch] = useState(\"\");\n  const [previewDoc, setPreviewDoc] = useState<GeneratedDocument | null>(null);\n  const [pendingFavoriteId, setPendingFavoriteId] = useState<number | null>(null);\n  const [pendingDeleteId, setPendingDeleteId] = useState<number | null>(null);\n\n  const {\n    data,\n    isLoading,\n    isFetching,\n    refetch,\n  } = trpc.documentGenerator.getMyDocuments.useQuery(documentsQueryInput, {\n    enabled: isAuthenticated,\n    staleTime: 1000 * 60 * 2,\n  });\n\n  const documentsData = data?.documents;\n  const documents = useMemo(() => documentsData ?? [], [documentsData]);\n\n  const toggleSaveMutation = trpc.documentGenerator.toggleSaveDocument.useMutation({\n    onSuccess: result => {\n      toast.success(result.isSaved ? \"تم حفظ المستند في المفضلة\" : \"تمت إزالته من المفضلة\");\n      utils.documentGenerator.getMyDocuments.invalidate(documentsQueryInput);\n    },\n    onError: () => toast.error(\"تعذر تحديث حالة المستند\"),\n  });\n\n  const deleteDocumentMutation = trpc.documentGenerator.deleteDocument.useMutation({\n    onSuccess: () => {\n      toast.success(\"تم حذف المستند نهائياً\");\n      utils.documentGenerator.getMyDocuments.invalidate(documentsQueryInput);\n    },\n    onError: () => toast.error(\"تعذر حذف المستند\"),\n  });\n\n  const filteredDocuments = useMemo(() => {\n    const normalizedSearch = search.trim().toLowerCase();\n    return documents.filter(doc => {\n      if (tab === \"saved\" && !isSavedDocument(doc)) return false;\n      if (tab === \"draft\" && isSavedDocument(doc)) return false;\n      if (!normalizedSearch) return true;\n      const haystack = `${getDocTitle(doc)} ${doc.templateCode ?? \"\"} ${doc.companyName ?? \"\"}`.toLowerCase();\n      return haystack.includes(normalizedSearch);\n    });\n  }, [documents, tab, search]);\n\n  const stats = useMemo(() => {\n    const total = documents.length;\n    const saved = documents.filter(isSavedDocument).length;\n    const drafts = total - saved;\n    const recent = documents.filter(doc => {\n      if (!doc.createdAt) return false;\n      const createdAt = typeof doc.createdAt === \"string\" ? new Date(doc.createdAt) : doc.createdAt;\n      return Date.now() - createdAt.getTime() <= RECENT_WINDOW_MS;\n    }).length;\n    return { total, saved, drafts, recent };\n  }, [documents]);\n\n  const handleToggleFavorite = (docId: number) => {\n    setPendingFavoriteId(docId);\n    toggleSaveMutation.mutate(\n      { documentId: docId },\n      {\n        onSettled: () => setPendingFavoriteId(null),\n      }\n    );\n  };\n\n  const handleDelete = (docId: number) => {\n    setPendingDeleteId(docId);\n    deleteDocumentMutation.mutate(\n      { documentId: docId },\n      {\n        onSettled: () => setPendingDeleteId(null),\n      }\n    );\n  };\n\n  const handleDownload = (doc: GeneratedDocument) => {\n    const content = doc.outputHtml || doc.outputText || doc.content;\n    if (!content) {\n      toast.info(\"لا يوجد محتوى قابل للتنزيل لهذا المستند حالياً\");\n      return;\n    }\n\n    try {\n      const isHtml = Boolean(doc.outputHtml);\n      const blob = new Blob([content], {\n        type: isHtml ? \"text/html;charset=utf-8\" : \"text/plain;charset=utf-8\",\n      });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement(\"a\");\n      link.href = url;\n  const safeTitle = getDocTitle(doc).replace(SAFE_TITLE_REGEX, \"\").trim() || \"document\";\n      link.download = `${safeTitle}-${doc.id}.${isHtml ? \"html\" : \"txt\"}`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      toast.success(\"تم تجهيز المستند للتحميل\");\n    } catch {\n      toast.error(\"حدث خطأ أثناء تجهيز الملف\");\n    }\n  };\n\n  const handleRefresh = () => {\n    if (!isAuthenticated) return;\n    refetch();\n  };\n\n  const isEmptyState = filteredDocuments.length === 0;\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <div className=\"container mx-auto px-4 py-10 space-y-6\">\n        <div className=\"flex items-center justify-between gap-3 flex-wrap\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-slate-900\">مكتبتي</h1>\n            <p className=\"text-muted-foreground\">\n              جميع المستندات التي تم توليدها أو حفظها من الأدوات الذكية.\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setTab(\"saved\")}\n              className={tab === \"saved\" ? \"border-blue-500 text-blue-600\" : undefined}\n            >\n              <Bookmark className=\"h-4 w-4 ml-2\" />\n              المفضلة\n            </Button>\n            <Button\n              className=\"bg-gradient-to-r from-purple-600 to-blue-600\"\n              onClick={() => navigate(\"/document-generator\")}\n            >\n              + مستند جديد\n            </Button>\n          </div>\n        </div>\n\n        {isAuthenticated ? (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-4\">\n              {[\n                { label: \"إجمالي المستندات\", value: stats.total },\n                { label: \"محفوظ\", value: stats.saved },\n                { label: \"مسودات\", value: stats.drafts },\n                { label: \"آخر 7 أيام\", value: stats.recent },\n              ].map(item => (\n                <Card key={item.label}>\n                  <CardContent className=\"p-4\">\n                    <p className=\"text-sm text-muted-foreground\">{item.label}</p>\n                    <p className=\"text-2xl font-bold\">{item.value}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n            <Card>\n              <CardHeader className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n                <div>\n                  <CardTitle>المحفوظات</CardTitle>\n                  <CardDescription>فلترة، بحث، وتنزيل المستندات</CardDescription>\n                </div>\n                <Button variant=\"ghost\" size=\"sm\" onClick={handleRefresh} disabled={isFetching}>\n                  {isFetching ? <Loader2 className=\"h-4 w-4 ml-2 animate-spin\" /> : <RefreshCw className=\"h-4 w-4 ml-2\" />}\n                  تحديث\n                </Button>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex flex-wrap items-center gap-3\">\n                  <Tabs value={tab} onValueChange={val => setTab(val as FilterTab)}>\n                    <TabsList>\n                      <TabsTrigger value=\"all\">الكل</TabsTrigger>\n                      <TabsTrigger value=\"saved\">المحفوظة</TabsTrigger>\n                      <TabsTrigger value=\"draft\">مسودات</TabsTrigger>\n                    </TabsList>\n                  </Tabs>\n                  <div className=\"flex items-center gap-2 w-full md:w-72\">\n                    <Search className=\"h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"بحث باسم المستند أو الشركة\"\n                      value={search}\n                      onChange={e => setSearch(e.target.value)}\n                    />\n                  </div>\n                </div>\n\n                {isLoading ? (\n                  <div className=\"space-y-3\">\n                    {Array.from({ length: 3 }).map((_, idx) => (\n                      <Skeleton key={idx} className=\"h-24 w-full rounded-2xl\" />\n                    ))}\n                  </div>\n                ) : isEmptyState ? (\n                  <div className=\"rounded-2xl border border-dashed p-8 text-center text-muted-foreground\">\n                    لا توجد مستندات مطابقة لخيارات البحث الحالية. قم بتوليد مستند جديد أو عدّل عوامل التصفية.\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"text-right\">العنوان</TableHead>\n                        <TableHead className=\"text-right\">النوع</TableHead>\n                        <TableHead className=\"text-right\">اللغة</TableHead>\n                        <TableHead className=\"text-right\">التاريخ</TableHead>\n                        <TableHead className=\"text-right\">ملخص</TableHead>\n                        <TableHead className=\"text-right\">إجراءات</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredDocuments.map(doc => {\n                        const saved = isSavedDocument(doc);\n                        return (\n                          <TableRow key={doc.id}>\n                            <TableCell>\n                              <div className=\"flex items-center gap-2 font-medium\">\n                                <FileText className=\"h-4 w-4 text-purple-600\" />\n                                {getDocTitle(doc)}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {doc.templateCode && <Badge variant=\"outline\">{doc.templateCode}</Badge>}\n                                {doc.companyName && <Badge variant=\"secondary\">{doc.companyName}</Badge>}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              {doc.lang && (\n                                <Badge variant=\"outline\">\n                                  {doc.lang === \"ar\"\n                                    ? \"العربية\"\n                                    : doc.lang === \"en\"\n                                    ? \"الإنجليزية\"\n                                    : \"ثنائي\"}\n                                </Badge>\n                              )}\n                            </TableCell>\n                            <TableCell>{formatDate(doc.createdAt)}</TableCell>\n                            <TableCell className=\"text-sm text-muted-foreground\">{getDocSnippet(doc)}</TableCell>\n                            <TableCell>\n                              <div className=\"flex flex-wrap gap-2\">\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => setPreviewDoc(doc)}>\n                                  <Eye className=\"h-4 w-4 ml-1\" />\n                                  عرض\n                                </Button>\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleDownload(doc)}>\n                                  <Download className=\"h-4 w-4 ml-1\" />\n                                  تحميل\n                                </Button>\n                                <Button\n                                  variant={saved ? \"default\" : \"ghost\"}\n                                  size=\"sm\"\n                                  onClick={() => handleToggleFavorite(doc.id)}\n                                  disabled={pendingFavoriteId === doc.id && toggleSaveMutation.isPending}\n                                >\n                                  {pendingFavoriteId === doc.id && toggleSaveMutation.isPending ? (\n                                    <Loader2 className=\"h-4 w-4 ml-1 animate-spin\" />\n                                  ) : (\n                                    <Bookmark\n                                      className=\"h-4 w-4 ml-1\"\n                                      fill={saved ? \"currentColor\" : \"none\"}\n                                    />\n                                  )}\n                                  {saved ? \"إزالة\" : \"حفظ\"}\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  className=\"text-red-600\"\n                                  onClick={() => handleDelete(doc.id)}\n                                  disabled={pendingDeleteId === doc.id && deleteDocumentMutation.isPending}\n                                >\n                                  {pendingDeleteId === doc.id && deleteDocumentMutation.isPending ? (\n                                    <Loader2 className=\"h-4 w-4 ml-1 animate-spin\" />\n                                  ) : (\n                                    <Trash2 className=\"h-4 w-4 ml-1\" />\n                                  )}\n                                  حذف\n                                </Button>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </>\n        ) : (\n          <Card>\n            <CardContent className=\"py-16 text-center text-muted-foreground\">\n              قم بتسجيل الدخول للوصول إلى مكتبة المستندات الخاصة بك.\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <DocumentPreviewDialog\n        document={previewDoc}\n        open={Boolean(previewDoc)}\n        onOpenChange={open => {\n          if (!open) setPreviewDoc(null);\n        }}\n      />\n    </div>\n  );\n}\n"],"names":["MAX_DOCUMENTS","RECENT_WINDOW_MS","SAFE_TITLE_REGEX","formatDate","value","date","isSavedDocument","doc","formatTemplateCode","code","part","getDocTitle","getDocSnippet","maxLength","raw","plain","DocumentPreviewDialog","document","open","onOpenChange","Dialog","jsxs","DialogContent","jsx","DialogHeader","DialogTitle","ScrollArea","MyDocuments","isAuthenticated","useAuth","navigate","useLocation","utils","trpc","documentsQueryInput","tab","setTab","useState","search","setSearch","previewDoc","setPreviewDoc","pendingFavoriteId","setPendingFavoriteId","pendingDeleteId","setPendingDeleteId","data","isLoading","isFetching","refetch","documentsData","documents","useMemo","toggleSaveMutation","result","toast","deleteDocumentMutation","filteredDocuments","normalizedSearch","stats","total","saved","drafts","recent","createdAt","handleToggleFavorite","docId","handleDelete","handleDownload","content","isHtml","blob","url","link","safeTitle","handleRefresh","isEmptyState","Button","Bookmark","Fragment","item","Card","CardContent","CardHeader","CardTitle","CardDescription","Loader2","RefreshCw","Tabs","val","TabsList","TabsTrigger","Search","Input","e","_","idx","Skeleton","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","FileText","Badge","Eye","Download","Trash2"],"mappings":"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"}