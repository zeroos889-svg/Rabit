import{r,j as e}from"./ui-vendor-C96WIwkg.js";import{m as de,t as I,b as o,C as z,c as Q,d as Z,F as me,e as J,f as K,B as h,k as S,I as W,S as pe,r as ue}from"./index-Bkz6h1fQ.js";import{B as f}from"./badge-DdDRUR73.js";import{L as b}from"./label-CmhXhWbA.js";import{T as he}from"./textarea-CDZ7LSXO.js";import{S as F,a as M,b as B,c as P,d as g}from"./select-B0y6YODy.js";import{S as xe}from"./separator-DBdTAbb0.js";import{R as ye}from"./refresh-cw-X5VGk4GL.js";import{C as ge}from"./copy-DQbqR9uy.js";import{D as je}from"./download-BYvKutrd.js";import{S as fe}from"./save-B9sIv-x9.js";import{C as be}from"./circle-check-DlUG-57U.js";import"./react-vendor-DDxydHEc.js";import"./query-vendor-Dpt6u7bR.js";import"./chart-vendor-8DIN3ZwM.js";const X=[{code:"salary-letter",title:"خطاب تعريف بالراتب",category:"تعريف",body:`إلى من يهمه الأمر،

نفيدكم بأن الموظف {{employee_name}} يعمل لدينا في {{company_name}} بوظيفة {{job_title}} منذ {{start_date}} ويتقاضى راتباً شهرياً قدره {{salary}} ريال.

تحريراً في {{issue_date}}،
{{company_name}}`,placeholders:[{key:"employee_name",label:"اسم الموظف"},{key:"company_name",label:"اسم الشركة"},{key:"job_title",label:"المسمى الوظيفي"},{key:"start_date",label:"تاريخ البداية"},{key:"salary",label:"الراتب"},{key:"issue_date",label:"تاريخ الإصدار"}]},{code:"offer-letter",title:"عرض وظيفي",category:"توظيف",body:`يسر {{company_name}} أن يقدم لكم عرض عمل لوظيفة {{job_title}} في قسم {{department}} براتب شهري {{salary}} ريال.

تاريخ المباشرة المتوقع: {{start_date}}
يرجى تأكيد قبول العرض خلال 5 أيام عمل.

مع خالص التحية،
فريق الموارد البشرية`,placeholders:[{key:"company_name",label:"اسم الشركة"},{key:"job_title",label:"المسمى الوظيفي"},{key:"department",label:"القسم"},{key:"salary",label:"الراتب"},{key:"start_date",label:"تاريخ المباشرة"}]},{code:"experience-letter",title:"شهادة خبرة",category:"خبرة",body:`نشهد بأن السيد/السيدة {{employee_name}} عمل معنا في {{company_name}} بوظيفة {{job_title}} في الفترة من {{start_date}} حتى {{end_date}}.

خلال تلك المدة أظهر التزاماً ومهنية عالية.
تمنياتنا له بالتوفيق.

{{company_name}}`,placeholders:[{key:"employee_name",label:"اسم الموظف"},{key:"company_name",label:"اسم الشركة"},{key:"job_title",label:"المسمى الوظيفي"},{key:"start_date",label:"تاريخ البداية"},{key:"end_date",label:"تاريخ النهاية"}]}],se=[{key:"employeeName",label:"اسم الموظف"},{key:"employeeId",label:"الرقم الوظيفي"},{key:"companyName",label:"اسم الشركة"},{key:"jobTitle",label:"المسمى الوظيفي"},{key:"department",label:"القسم"},{key:"startDate",label:"تاريخ البداية"},{key:"endDate",label:"تاريخ النهاية"},{key:"salary",label:"الراتب"},{key:"issueDate",label:"تاريخ الإصدار"}],Y=t=>{if(!t)return[];try{const n=typeof t=="string"?JSON.parse(t):t;if(Array.isArray(n))return n.map(a=>({key:typeof a?.key=="string"?a.key:"",label:typeof a?.label=="string"?a.label:typeof a?.key=="string"?a.key:"حقل",placeholder:typeof a?.placeholder=="string"?a.placeholder:void 0,required:typeof a?.required=="boolean"?a.required:void 0,type:typeof a?.type=="string"?a.type:void 0})).filter(a=>a.key);if(n&&Array.isArray(n.fields))return n.fields.map(a=>({key:typeof a?.key=="string"?a.key:"",label:typeof a?.label=="string"?a.label:typeof a?.key=="string"?a.key:"حقل",placeholder:typeof a?.placeholder=="string"?a.placeholder:void 0,required:typeof a?.required=="boolean"?a.required:void 0,type:typeof a?.type=="string"?a.type:void 0})).filter(a=>a.key)}catch(n){console.warn("Invalid placeholders schema",n)}return[]},ve=t=>({code:t.code,title:t.titleAr||t.nameAr||t.titleEn||t.nameEn||t.code,category:t.nameAr,description:t.description||void 0,body:t.content||void 0,placeholders:Y(t.placeholdersSchema).length>0?Y(t.placeholdersSchema):se}),ee=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase(),ke=(t,n)=>Object.entries(n).reduce((a,[d,w])=>{const j=w||`{{${d}}}`;return Array.from(new Set([d,d.toLowerCase(),ee(d),d.replace(/_/g,""),ee(d).replace(/_/g,"")])).reduce((x,_)=>{const c=new RegExp(`{{s*${_}s*}}`,"gi");return x.replace(c,j)},a)},t),Ne={رسمي:"formal","شبه رسمي":"semi-formal",ودي:"friendly"},Se={ar:"العربية",en:"English",both:"ثنائي"},we=t=>t==="ar"||t==="en"||t==="both",_e=t=>t==="رسمي"||t==="شبه رسمي"||t==="ودي";function He(){const{user:t}=de(),[n,a]=r.useState(X[0]?.code||""),[d,w]=r.useState("ar"),[j,R]=r.useState("رسمي"),[x,_]=r.useState(!0),[c,C]=r.useState({}),[$,ae]=r.useState(""),[q,te]=r.useState(null),[v,V]=r.useState(""),[T,H]=r.useState(""),[O,G]=r.useState(null),[U,L]=r.useState(!1),p=I.documentGenerator.getTemplates.useQuery(void 0,{staleTime:1e3*60*5});r.useEffect(()=>{p.error&&o.error("تعذر تحميل القوالب، سيتم استخدام القوالب الافتراضية")},[p.error]);const u=r.useMemo(()=>p.data?.templates?.length?p.data.templates.map(ve):X,[p.data]);r.useEffect(()=>{u.length&&a(s=>s&&u.some(l=>l.code===s)?s:u[0].code)},[u]);const m=r.useMemo(()=>u.find(s=>s.code===n)||u[0],[n,u]),k=r.useMemo(()=>m?.placeholders?.length?m.placeholders:se,[m]);r.useEffect(()=>{k.length&&C(s=>{const l={};return k.forEach(i=>{l[i.key]=s[i.key]||""}),l})},[k]),r.useEffect(()=>{V(""),H(""),G(null),L(!1)},[n]);const D=r.useMemo(()=>{if(m?.body)return ke(m.body,c);const s=Object.entries(c).filter(([,l])=>!!l).map(([l,i])=>`${l}: ${i}`).join(`
`);return s||"سيتم توليد المستند فور تعبئة الحقول والضغط على توليد"},[m,c]),N=I.documentGenerator.generateDocument.useMutation({onSuccess:s=>{V(s.outputHtml||""),H(s.outputText||""),G(s.documentId??null),L(!1),o.success("تم توليد المستند وحفظه في السجل")},onError:s=>{o.error(s.message||"فشل في توليد المستند، حاول مرة أخرى")}}),E=I.documentGenerator.toggleSaveDocument.useMutation({onSuccess:s=>{L(s.isSaved),o.success(s.isSaved?"تم حفظ المستند في مكتبتي":"تمت إزالة المستند من المفضلة")},onError:s=>{o.error(s.message||"تعذر تحديث حالة الحفظ")}}),re=async()=>{if(!t){o.error("الرجاء تسجيل الدخول للاستفادة من مولد المستندات");return}if(!m){o.error("لم يتم العثور على القالب");return}const s=k.filter(y=>y.required&&!c[y.key]?.trim());if(s.length){o.error(`يرجى تعبئة الحقول: ${s.map(y=>y.label).join("، ")}`);return}const l={...c,notes:$,includeStamp:x,tone:j,language:d},i=c.companyName||c.company_name||c.company||void 0;await N.mutateAsync({templateCode:m.code,inputData:l,lang:d,style:Ne[j],companyName:i,companyLogo:x?"auto-stamp":void 0})},le=async()=>{const s=T||D;if(!s){o.info("لا يوجد نص لنسخه بعد");return}await navigator.clipboard.writeText(s),o.success("تم نسخ المستند للحافظة")},ne=()=>{const s=v||T||D;if(!s){o.info("قم بتوليد المستند قبل التحميل");return}const l=!!v,i=new Blob([v||s],{type:l?"text/html;charset=utf-8":"text/plain;charset=utf-8"}),y=URL.createObjectURL(i),A=document.createElement("a");A.href=y;const ie=(m?.title||"document").replace(/[^a-zA-Z0-9\u0600-\u06FF]+/g,"-");A.download=`${ie||"document"}.${l?"html":"txt"}`,A.click(),URL.revokeObjectURL(y),o.success("تم تجهيز المستند للتحميل")},oe=()=>{if(!t){o.error("الرجاء تسجيل الدخول لحفظ المستندات");return}if(!O){o.info("قم بتوليد المستند أولاً");return}E.mutate({documentId:O})},ce=()=>{te(`اقتراح: أضف فقرة توضح الغرض من المستند "${m?.title||"المستند"}" وتأكيد صحة البيانات.`)};return e.jsx("div",{className:"min-h-screen bg-slate-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-10 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(f,{className:"w-fit",children:"مولد المستندات الذكي"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"أنشئ مستندات جاهزة بثوانٍ"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl",children:"اختر قالباً، املأ المتغيرات الأساسية، واحصل على مستند منسق مع خيار ختم إلكتروني وإدراج الشعار لاحقاً."})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.2fr_1fr]",children:[e.jsxs(z,{className:"shadow-sm",children:[e.jsxs(Q,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-purple-600"}),"بيانات المستند"]}),e.jsx(J,{children:"املأ المعلومات الأساسية وسيتم توليد المستند فوراً"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(b,{children:"القالب"}),e.jsx(h,{variant:"ghost",size:"sm",className:"text-xs",onClick:()=>p.refetch(),disabled:p.isFetching,children:p.isFetching?e.jsx(S,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(ye,{className:"h-3.5 w-3.5"})})]}),e.jsxs(F,{value:n,onValueChange:a,children:[e.jsx(M,{children:e.jsx(B,{})}),e.jsx(P,{children:u.map(s=>e.jsx(g,{value:s.code,children:s.title},s.code))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"اللغة"}),e.jsxs(F,{value:d,onValueChange:s=>{we(s)&&w(s)},children:[e.jsx(M,{children:e.jsx(B,{})}),e.jsxs(P,{children:[e.jsx(g,{value:"ar",children:"العربية"}),e.jsx(g,{value:"en",children:"English"}),e.jsx(g,{value:"both",children:"ثنائي"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"نبرة المستند"}),e.jsxs(F,{value:j,onValueChange:s=>{_e(s)&&R(s)},children:[e.jsx(M,{children:e.jsx(B,{})}),e.jsxs(P,{children:[e.jsx(g,{value:"رسمي",children:"رسمي"}),e.jsx(g,{value:"شبه رسمي",children:"شبه رسمي"}),e.jsx(g,{value:"ودي",children:"ودي"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الختم والشعار"}),e.jsx(h,{variant:x?"default":"outline",onClick:()=>_(s=>!s),className:"w-full",children:x?"تضمين الختم":"بدون ختم"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"ملاحظات إضافية"}),e.jsx(W,{placeholder:"مثال: نسخة للبنك",value:$,onChange:s=>ae(s.target.value)})]})]}),e.jsx(xe,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:k.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.label}),s.required&&e.jsx("span",{className:"text-xs text-red-500",children:"مطلوب"})]}),s.type==="textarea"?e.jsx(he,{rows:3,placeholder:s.placeholder,value:c[s.key]||"",onChange:l=>C(i=>({...i,[s.key]:l.target.value}))}):e.jsx(W,{placeholder:s.placeholder,value:c[s.key]||"",onChange:l=>C(i=>({...i,[s.key]:l.target.value}))})]},s.key))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{onClick:re,className:"bg-gradient-to-r from-purple-600 to-blue-600",disabled:N.isPending,children:[N.isPending?e.jsx(S,{className:"h-4 w-4 ml-2 animate-spin"}):e.jsx(pe,{className:"h-4 w-4 ml-2"}),N.isPending?"جاري التوليد":"توليد المستند"]}),e.jsxs(h,{variant:"outline",onClick:ce,children:[e.jsx(ue,{className:"h-4 w-4 ml-2"}),"اقتراح من الذكاء الاصطناعي"]})]}),q&&e.jsx("div",{className:"p-3 rounded-lg bg-blue-50 text-sm text-blue-900",children:q})]})]}),e.jsxs(z,{className:"shadow-sm",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"معاينة المستند"}),e.jsx(J,{children:"يمكنك النسخ أو التحميل أو الحفظ في مكتبتي"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(f,{variant:"outline",children:m?.title}),e.jsx(f,{variant:"secondary",children:j}),e.jsx(f,{variant:"outline",children:Se[d]}),x&&e.jsx(f,{className:"bg-emerald-100 text-emerald-700",children:"ختم إلكتروني"}),p.isFetching&&e.jsxs(f,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3.5 w-3.5 animate-spin"})," تحديث القوالب"]})]}),e.jsx("div",{className:"rounded-xl border bg-white p-4 min-h-[260px] space-y-3",children:v?e.jsx("div",{className:"prose prose-sm max-w-none rtl text-right",dangerouslySetInnerHTML:{__html:v}}):e.jsx("pre",{className:"whitespace-pre-wrap text-sm leading-6",children:T||D})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(h,{variant:"outline",onClick:le,children:[e.jsx(ge,{className:"h-4 w-4 ml-2"}),"نسخ"]}),e.jsxs(h,{variant:"outline",onClick:ne,children:[e.jsx(je,{className:"h-4 w-4 ml-2"}),"تحميل PDF/Word"]}),e.jsxs(h,{variant:U?"default":"outline",onClick:oe,disabled:E.isPending,children:[E.isPending?e.jsx(S,{className:"h-4 w-4 ml-2 animate-spin"}):e.jsx(fe,{className:"h-4 w-4 ml-2"}),U?"تم الحفظ":"حفظ في مكتبتي"]}),e.jsxs(h,{variant:"ghost",children:[e.jsx(be,{className:"h-4 w-4 ml-2"}),"إرسال للمراجعة"]})]})]})]})]})]})})}export{He as default};
