import{r as N,j as e}from"./ui-vendor-C96WIwkg.js";import{t as o,b as x,C as i,c as l,d as n,f as d,H as v,y as b,B as h,I as E,p as T}from"./index-Bkz6h1fQ.js";import{B as D}from"./badge-DdDRUR73.js";import{M as B}from"./mail-hhykUda4.js";import{C as $}from"./circle-check-DlUG-57U.js";import{C as P}from"./clock-BFXiIUou.js";import"./react-vendor-DDxydHEc.js";import"./query-vendor-Dpt6u7bR.js";import"./chart-vendor-8DIN3ZwM.js";function G(){const[a,y]=N.useState(null),[c,u]=N.useState(""),{data:C,refetch:p}=o.chat.getAllConversations.useQuery(void 0,{refetchInterval:5e3}),r=C??[],{data:w,refetch:S}=o.chat.getMessages.useQuery({conversationId:a},{enabled:!!a,refetchInterval:3e3}),j=w??[],m=o.chat.sendMessage.useMutation({onSuccess:()=>{u(""),S(),p()},onError:()=>{x.error("فشل إرسال الرسالة")}}),f=o.chat.updateStatus.useMutation({onSuccess:()=>{x.success("تم تحديث حالة المحادثة"),p()},onError:()=>{x.error("فشل تحديث الحالة")}}),g=()=>{!c.trim()||!a||m.mutate({conversationId:a,message:c.trim()})},M=s=>{f.mutate({id:s,status:"closed"})},k=s=>{f.mutate({id:s,status:"open"})},t=r.find(s=>s.id===a),I=r.filter(s=>s.status==="open"),A=r.filter(s=>s.status==="closed");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"الدردشة المباشرة"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة محادثات الزوار والرد عليهم"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs(i,{children:[e.jsx(l,{className:"pb-3",children:e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"المحادثات المفتوحة"})}),e.jsx(d,{children:e.jsx("div",{className:"text-3xl font-bold",children:I.length})})]}),e.jsxs(i,{children:[e.jsx(l,{className:"pb-3",children:e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"المحادثات المغلقة"})}),e.jsx(d,{children:e.jsx("div",{className:"text-3xl font-bold",children:A.length})})]}),e.jsxs(i,{children:[e.jsx(l,{className:"pb-3",children:e.jsx(n,{className:"text-sm font-medium text-muted-foreground",children:"إجمالي المحادثات"})}),e.jsx(d,{children:e.jsx("div",{className:"text-3xl font-bold",children:r.length})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 h-[600px]",children:[e.jsxs(i,{className:"md:col-span-1",children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"المحادثات"]})}),e.jsx(d,{className:"p-0",children:e.jsx(b,{className:"h-[500px]",children:r.length===0?e.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"لا توجد محادثات"}):e.jsx("div",{className:"space-y-1 p-2",children:r.map(s=>e.jsxs("button",{onClick:()=>y(s.id),className:`w-full text-right p-3 rounded-lg transition-colors ${a===s.id?"bg-primary/10 border-2 border-primary":"hover:bg-gray-100 border-2 border-transparent"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white text-sm",children:s.visitorName?.[0]||"ز"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.visitorName||"زائر"}),s.visitorEmail&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.visitorEmail})]})]}),e.jsx(D,{variant:s.status==="open"?"default":"secondary",children:s.status==="open"?"مفتوحة":"مغلقة"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.lastMessageAt?new Date(s.lastMessageAt).toLocaleString("ar-SA"):"--"})]},s.id))})})})]}),e.jsx(i,{className:"md:col-span-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white",children:t.visitorName?.[0]||"ز"}),e.jsxs("div",{children:[e.jsx(n,{className:"text-lg",children:t.visitorName||"زائر"}),t.visitorEmail&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),t.visitorEmail]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.status==="open"?e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>M(t.id),children:[e.jsx($,{className:"h-4 w-4 ml-2"}),"إغلاق المحادثة"]}):e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>k(t.id),children:[e.jsx(P,{className:"h-4 w-4 ml-2"}),"إعادة فتح"]})})]})}),e.jsxs(d,{className:"p-0",children:[e.jsx(b,{className:"h-[400px] p-4",children:j.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"لا توجد رسائل"}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsx("div",{className:`flex ${s.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"flex flex-col max-w-[70%] space-y-1",children:[s.senderType==="assistant"&&e.jsx("span",{className:"text-[10px] text-blue-500 uppercase tracking-wide",children:"AI"}),e.jsxs("div",{className:`max-w-[70%] rounded-lg px-4 py-2 ${s.senderType==="admin"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":s.senderType==="assistant"?"bg-blue-50 text-blue-900 border border-blue-100":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.senderType==="admin"?"text-white/80":s.senderType==="assistant"?"text-blue-600":"text-gray-500"}`,children:new Date(s.createdAt||new Date().toISOString()).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]})]})},s.id))})}),t.status==="open"&&e.jsx("div",{className:"p-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{placeholder:"اكتب ردك...",value:c,onChange:s=>u(s.target.value),onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),g())},disabled:m.isPending}),e.jsx(h,{onClick:g,disabled:!c.trim()||m.isPending,className:"gradient-primary",children:e.jsx(T,{className:"h-4 w-4"})})]})})]})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"اختر محادثة للبدء"})]})})})]})]})}export{G as default};
