{"version":3,"file":"ConsultationDetail-Cw-K8HRq.js","sources":["../../../client/src/pages/ConsultationDetail.tsx"],"sourcesContent":["import { useParams, useLocation, Link } from \"wouter\";\nimport { trpc } from \"@/lib/trpc\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Calendar,\n  Clock,\n  MessageCircle,\n  ArrowLeft,\n  Loader2,\n  ShieldCheck,\n  Timer,\n} from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nconst statusLabels: Record<string, string> = {\n  open: \"مفتوحة\",\n  pending: \"قيد الانتظار\",\n  confirmed: \"مؤكدة\",\n  \"in-progress\": \"قيد التنفيذ\",\n  completed: \"مكتملة\",\n  cancelled: \"ملغاة\",\n};\n\nexport default function ConsultationDetail() {\n  const { id } = useParams<{ id: string }>();\n  const [, navigate] = useLocation();\n  const bookingId = Number(id);\n\n  const { data, isLoading } = trpc.consultant.getBooking.useQuery(\n    { bookingId },\n    { enabled: !!bookingId }\n  );\n\n  const calculateRemaining = () => {\n    const b = data?.booking;\n    if (!b?.createdAt) return null;\n    const sla = b.slaHours || b.consultationType?.slaHours || 24;\n    const due = new Date(b.createdAt);\n    due.setHours(due.getHours() + sla);\n    const diffMs = due.getTime() - Date.now();\n    if (diffMs <= 0) return \"انتهى الوقت المستهدف\";\n    const hours = Math.floor(diffMs / (1000 * 60 * 60));\n    const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n    return `${hours} ساعة ${minutes} دقيقة`;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-4\">\n        <Skeleton className=\"h-10 w-48\" />\n        <Skeleton className=\"h-48 w-full\" />\n      </div>\n    );\n  }\n\n  const booking = data?.booking;\n\n  if (!booking) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardContent className=\"py-10 text-center text-muted-foreground\">\n            الاستشارة غير موجودة.\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(\"/my-consultations\")}>\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <div>\n            <h1 className=\"text-2xl font-bold\">\n              استشارة #{booking.ticketNumber || bookingId}\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">\n              {booking.subject || booking.consultationType?.nameAr || \"استشارة الموارد البشرية\"}\n            </p>\n          </div>\n        </div>\n        <Badge variant=\"secondary\">\n          {statusLabels[booking.status || \"pending\"] || \"قيد الانتظار\"}\n        </Badge>\n      </div>\n\n      <div className=\"grid lg:grid-cols-3 gap-4\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>ملخص الاستشارة</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4 text-sm\">\n            <div className=\"grid sm:grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-muted-foreground\">المستشار</p>\n                <p className=\"font-semibold\">\n                  {booking.consultant?.fullNameAr || \"سيتم التعيين لاحقاً\"}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">نوع الاستشارة</p>\n                <p className=\"font-semibold\">\n                  {booking.consultationType?.nameAr || \"غير محدد\"}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">التاريخ</p>\n                <p className=\"font-semibold\">\n                  {booking.scheduledDate\n                    ? new Date(booking.scheduledDate).toLocaleDateString(\"ar-SA\")\n                    : \"لم يحدد\"}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">الوقت</p>\n                <p className=\"font-semibold\">{booking.scheduledTime || \"—\"}</p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">SLA</p>\n                <p className=\"font-semibold\">\n                  {booking.slaHours || booking.consultationType?.slaHours || 24} ساعة\n                </p>\n              </div>\n              <div>\n                <p className=\"text-muted-foreground\">السعر</p>\n                <p className=\"font-semibold text-primary\">\n                  {(booking.price || booking.consultationType?.price || 0).toLocaleString()} ريال\n                </p>\n              </div>\n            </div>\n\n            <div>\n              <p className=\"text-muted-foreground mb-1\">الوصف</p>\n              <p className=\"text-sm leading-relaxed\">{booking.description}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>الإجراءات</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <Button className=\"w-full\" asChild>\n                <Link href={`/consultation/${bookingId}/chat`}>\n                  <MessageCircle className=\"h-4 w-4 mr-2\" />\n                  الانتقال للمحادثة\n                </Link>\n              </Button>\n              <Button\n                variant=\"outline\"\n                className=\"w-full\"\n                onClick={() => navigate(\"/consulting/book-new\")}\n              >\n                حجز استشارة جديدة\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <ShieldCheck className=\"h-5 w-5 text-green-600\" />\n                SLA\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2 text-sm text-muted-foreground\">\n              <p>\n                يتم الرد خلال{\" \"}\n                <strong className=\"text-primary\">\n                  {booking.slaHours || booking.consultationType?.slaHours || 24} ساعة\n                </strong>{\" \"}\n                من وقت الحجز.\n              </p>\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4\" />\n                <span>تاريخ الإنشاء: {new Date(booking.createdAt || new Date()).toLocaleDateString(\"ar-SA\")}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-4 w-4\" />\n                <span>الوقت المتبقي: {calculateRemaining() || \"—\"}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Timer className=\"h-4 w-4\" />\n                <span>الوقت المستهدف للإنجاز وفق SLA</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["statusLabels","ConsultationDetail","id","useParams","navigate","useLocation","bookingId","data","isLoading","trpc","calculateRemaining","b","sla","due","diffMs","hours","minutes","jsxs","jsx","Skeleton","booking","Button","ArrowLeft","Badge","Card","CardHeader","CardTitle","CardContent","Link","MessageCircle","ShieldCheck","Calendar","Clock","Timer"],"mappings":"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"}